<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>tensorflow 笔记 | huazhe's blog</title><meta name="description" content="tensotflow笔记tfAPI查询 1.线性回归一组数据求回归方程 y&#x3D;wx+b 转化为求loss&#x3D;sum [(wxi+b-yi)**2]的minimize 梯度下降 w’&#x3D;w-learningrated(loss)&#x2F;dw         b’&#x3D;b-learningrated(loss)&#x2F;db 使得w’x+b’ -&gt; y import numpy as np   # y &#x3D; wx + b"><meta name="keywords" content="tensorflow"><meta name="author" content="huazhe"><meta name="copyright" content="huazhe"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="tensorflow 笔记"><meta name="twitter:description" content="tensotflow笔记tfAPI查询 1.线性回归一组数据求回归方程 y&#x3D;wx+b 转化为求loss&#x3D;sum [(wxi+b-yi)**2]的minimize 梯度下降 w’&#x3D;w-learningrated(loss)&#x2F;dw         b’&#x3D;b-learningrated(loss)&#x2F;db 使得w’x+b’ -&gt; y import numpy as np   # y &#x3D; wx + b"><meta name="twitter:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><meta property="og:type" content="article"><meta property="og:title" content="tensorflow 笔记"><meta property="og:url" content="http://huazhe1995.github.io/2020/03/15/tensorflow-bi-ji/"><meta property="og:site_name" content="huazhe's blog"><meta property="og:description" content="tensotflow笔记tfAPI查询 1.线性回归一组数据求回归方程 y&#x3D;wx+b 转化为求loss&#x3D;sum [(wxi+b-yi)**2]的minimize 梯度下降 w’&#x3D;w-learningrated(loss)&#x2F;dw         b’&#x3D;b-learningrated(loss)&#x2F;db 使得w’x+b’ -&gt; y import numpy as np   # y &#x3D; wx + b"><meta property="og:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><meta property="article:published_time" content="2020-03-15T14:12:50.000Z"><meta property="article:modified_time" content="2020-05-04T04:49:15.105Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://huazhe1995.github.io/2020/03/15/tensorflow-bi-ji/"><link rel="prev" title="ROS笔记" href="http://huazhe1995.github.io/2020/03/19/ros-bi-ji/"><link rel="next" title="ROS调用cv_bridge问题" href="http://huazhe1995.github.io/2020/03/14/ros-diao-yong-cv-bridge-wen-ti/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="huazhe's blog" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">17</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">17</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">7</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#tensotflow笔记"><span class="toc-number">1.</span> <span class="toc-text">tensotflow笔记</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-线性回归"><span class="toc-number">1.1.</span> <span class="toc-text">1.线性回归</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-图像分类mnist手写数据集"><span class="toc-number">1.2.</span> <span class="toc-text">2. 图像分类mnist手写数据集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-tensorflow数据类型"><span class="toc-number">1.3.</span> <span class="toc-text">3.tensorflow数据类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-创建tensor"><span class="toc-number">1.4.</span> <span class="toc-text">4.创建tensor</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-索引与切片"><span class="toc-number">1.5.</span> <span class="toc-text">5. 索引与切片</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-维度变换"><span class="toc-number">1.6.</span> <span class="toc-text">6.维度变换</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-Broadcasting"><span class="toc-number">1.7.</span> <span class="toc-text">7.Broadcasting</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-数学运算"><span class="toc-number">1.8.</span> <span class="toc-text">8.数学运算</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-前向传播"><span class="toc-number">1.9.</span> <span class="toc-text">9.前向传播</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-合并与分割"><span class="toc-number">1.10.</span> <span class="toc-text">10.合并与分割</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-数据统计"><span class="toc-number">1.11.</span> <span class="toc-text">11.数据统计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-张量排序"><span class="toc-number">1.12.</span> <span class="toc-text">12.张量排序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-填充与复制"><span class="toc-number">1.13.</span> <span class="toc-text">13.填充与复制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-张量限幅"><span class="toc-number">1.14.</span> <span class="toc-text">14.张量限幅</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-高级操作"><span class="toc-number">1.15.</span> <span class="toc-text">15.高级操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-数据加载"><span class="toc-number">1.16.</span> <span class="toc-text">16.数据加载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#17-全连接层"><span class="toc-number">1.17.</span> <span class="toc-text">17.全连接层</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-输出方式"><span class="toc-number">1.18.</span> <span class="toc-text">18.输出方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#19-损失函数"><span class="toc-number">1.19.</span> <span class="toc-text">19.损失函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#20-梯度下降"><span class="toc-number">1.20.</span> <span class="toc-text">20.梯度下降</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#21-函数优化"><span class="toc-number">1.21.</span> <span class="toc-text">21.函数优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fashion-mnist实战"><span class="toc-number">1.22.</span> <span class="toc-text">fashion mnist实战</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#23-tensorboard-数据可视化"><span class="toc-number">1.23.</span> <span class="toc-text">23.tensorboard 数据可视化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#24-keras高级API"><span class="toc-number">1.24.</span> <span class="toc-text">24.keras高级API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#25-自定义网络层"><span class="toc-number">1.25.</span> <span class="toc-text">25.自定义网络层</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#27-过拟合与欠拟合"><span class="toc-number">1.26.</span> <span class="toc-text">27.过拟合与欠拟合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#28-数据集划分和交叉验证"><span class="toc-number">1.27.</span> <span class="toc-text">28.数据集划分和交叉验证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#29-减轻过拟合的方法"><span class="toc-number">1.28.</span> <span class="toc-text">29.减轻过拟合的方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#30-training-tricks"><span class="toc-number">1.29.</span> <span class="toc-text">30.training tricks</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#31-卷积神经网络"><span class="toc-number">1.30.</span> <span class="toc-text">31.卷积神经网络</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#32-池化与采样"><span class="toc-number">1.31.</span> <span class="toc-text">32.池化与采样</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">huazhe's blog</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">tensorflow 笔记</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-03-15 22:12:50"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-03-15</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-05-04 12:49:15"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-05-04</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/note/">note</a></span></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="tensotflow笔记"><a href="#tensotflow笔记" class="headerlink" title="tensotflow笔记"></a>tensotflow笔记</h1><p><a href="https://www.tensorflow.org/api_docs/python/tf" target="_blank" rel="noopener">tfAPI查询</a></p>
<h2 id="1-线性回归"><a href="#1-线性回归" class="headerlink" title="1.线性回归"></a>1.线性回归</h2><p>一组数据求回归方程 y=wx+b</p>
<p>转化为求loss=sum [(wxi+b-yi)**2]的minimize</p>
<p>梯度下降 w’=w-learningrate<em>d(loss)/dw<br>         b’=b-learningrate</em>d(loss)/db</p>
<p>使得w’x+b’ -&gt; y</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np


<span class="token comment" spellcheck="true"># y = wx + b</span>
<span class="token keyword">def</span> <span class="token function">compute_error_for_line_given_points</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> w<span class="token punctuation">,</span> points<span class="token punctuation">)</span><span class="token punctuation">:</span>
    totalError <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">(</span>points<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> points<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>
        y <span class="token operator">=</span> points<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token comment" spellcheck="true"># computer mean-squared-error</span>
        totalError <span class="token operator">+=</span> <span class="token punctuation">(</span>y <span class="token operator">-</span> <span class="token punctuation">(</span>w <span class="token operator">*</span> x <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span>
    <span class="token comment" spellcheck="true"># average loss for each point</span>
    <span class="token keyword">return</span> totalError <span class="token operator">/</span> float<span class="token punctuation">(</span>len<span class="token punctuation">(</span>points<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">step_gradient</span><span class="token punctuation">(</span>b_current<span class="token punctuation">,</span> w_current<span class="token punctuation">,</span> points<span class="token punctuation">,</span> learningRate<span class="token punctuation">)</span><span class="token punctuation">:</span>
    b_gradient <span class="token operator">=</span> <span class="token number">0</span>
    w_gradient <span class="token operator">=</span> <span class="token number">0</span>
    N <span class="token operator">=</span> float<span class="token punctuation">(</span>len<span class="token punctuation">(</span>points<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">(</span>points<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> points<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>
        y <span class="token operator">=</span> points<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token comment" spellcheck="true"># grad_b = 2(wx+b-y)</span>
        b_gradient <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">/</span>N<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>w_current <span class="token operator">*</span> x <span class="token operator">+</span> b_current<span class="token punctuation">)</span> <span class="token operator">-</span> y<span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># grad_w = 2(wx+b-y)*x</span>
        w_gradient <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">/</span>N<span class="token punctuation">)</span> <span class="token operator">*</span> x <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>w_current <span class="token operator">*</span> x <span class="token operator">+</span> b_current<span class="token punctuation">)</span> <span class="token operator">-</span> y<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># update w'</span>
    new_b <span class="token operator">=</span> b_current <span class="token operator">-</span> <span class="token punctuation">(</span>learningRate <span class="token operator">*</span> b_gradient<span class="token punctuation">)</span>
    new_w <span class="token operator">=</span> w_current <span class="token operator">-</span> <span class="token punctuation">(</span>learningRate <span class="token operator">*</span> w_gradient<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>new_b<span class="token punctuation">,</span> new_w<span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">gradient_descent_runner</span><span class="token punctuation">(</span>points<span class="token punctuation">,</span> starting_b<span class="token punctuation">,</span> starting_w<span class="token punctuation">,</span> learning_rate<span class="token punctuation">,</span> num_iterations<span class="token punctuation">)</span><span class="token punctuation">:</span>
    b <span class="token operator">=</span> starting_b
    w <span class="token operator">=</span> starting_w
    <span class="token comment" spellcheck="true"># update for several times</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>num_iterations<span class="token punctuation">)</span><span class="token punctuation">:</span>
        b<span class="token punctuation">,</span> w <span class="token operator">=</span> step_gradient<span class="token punctuation">(</span>b<span class="token punctuation">,</span> w<span class="token punctuation">,</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>points<span class="token punctuation">)</span><span class="token punctuation">,</span> learning_rate<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>b<span class="token punctuation">,</span> w<span class="token punctuation">]</span>


<span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    points <span class="token operator">=</span> np<span class="token punctuation">.</span>genfromtxt<span class="token punctuation">(</span><span class="token string">"data.csv"</span><span class="token punctuation">,</span> delimiter<span class="token operator">=</span><span class="token string">","</span><span class="token punctuation">)</span>
    learning_rate <span class="token operator">=</span> <span class="token number">0.0001</span>
    initial_b <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment" spellcheck="true"># initial y-intercept guess</span>
    initial_w <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment" spellcheck="true"># initial slope guess</span>
    num_iterations <span class="token operator">=</span> <span class="token number">1000</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Starting gradient descent at b = {0}, w = {1}, error = {2}"</span>
          <span class="token punctuation">.</span>format<span class="token punctuation">(</span>initial_b<span class="token punctuation">,</span> initial_w<span class="token punctuation">,</span>
                  compute_error_for_line_given_points<span class="token punctuation">(</span>initial_b<span class="token punctuation">,</span> initial_w<span class="token punctuation">,</span> points<span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Running..."</span><span class="token punctuation">)</span>
    <span class="token punctuation">[</span>b<span class="token punctuation">,</span> w<span class="token punctuation">]</span> <span class="token operator">=</span> gradient_descent_runner<span class="token punctuation">(</span>points<span class="token punctuation">,</span> initial_b<span class="token punctuation">,</span> initial_w<span class="token punctuation">,</span> learning_rate<span class="token punctuation">,</span> num_iterations<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"After {0} iterations b = {1}, w = {2}, error = {3}"</span><span class="token punctuation">.</span>
          format<span class="token punctuation">(</span>num_iterations<span class="token punctuation">,</span> b<span class="token punctuation">,</span> w<span class="token punctuation">,</span>
                 compute_error_for_line_given_points<span class="token punctuation">(</span>b<span class="token punctuation">,</span> w<span class="token punctuation">,</span> points<span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    run<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="2-图像分类mnist手写数据集"><a href="#2-图像分类mnist手写数据集" class="headerlink" title="2. 图像分类mnist手写数据集"></a>2. 图像分类mnist手写数据集</h2><p>iteration：表示1次迭代（也叫training step），每次迭代更新1次网络结构的参数；<br>batch-size：1次迭代所使用的样本量；<br>epoch：1个epoch表示过了1遍训练集中的所有样本。</p>
<p>图像[28,28,1] -&gt; [784]</p>
<p>X:[b,784] 图像数目b<br>W:[784,10] 图像类别10<br>b:[10]<br>out=X@W + b #out:[b,10]</p>
<p>out=relu(X@W + b)<br>修正线性单元(Rectified linear unit，ReLU）神经元的激活函数<br>如果不适用激励函数，那么在这种情况下每一层的输出都是上层输入的线性函数，很容易验证，无论你神经网络有多少层，输出都是输入的线性组合，与没有隐藏层效果相当</p>
<p>梯度消失 sigmoid函数正无穷和负无穷</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span>  os
<span class="token keyword">import</span>  tensorflow <span class="token keyword">as</span> tf
<span class="token keyword">from</span>    tensorflow <span class="token keyword">import</span> keras
<span class="token keyword">from</span>    tensorflow<span class="token punctuation">.</span>keras <span class="token keyword">import</span> layers<span class="token punctuation">,</span> optimizers<span class="token punctuation">,</span> datasets


os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'TF_CPP_MIN_LOG_LEVEL'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'2'</span>

<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x_val<span class="token punctuation">,</span> y_val<span class="token punctuation">)</span> <span class="token operator">=</span> datasets<span class="token punctuation">.</span>mnist<span class="token punctuation">.</span>load_data<span class="token punctuation">(</span><span class="token punctuation">)</span> 
x <span class="token operator">=</span> tf<span class="token punctuation">.</span>convert_to_tensor<span class="token punctuation">(</span>x<span class="token punctuation">,</span> dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">255</span><span class="token punctuation">.</span>
y <span class="token operator">=</span> tf<span class="token punctuation">.</span>convert_to_tensor<span class="token punctuation">(</span>y<span class="token punctuation">,</span> dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>int32<span class="token punctuation">)</span>
y <span class="token operator">=</span> tf<span class="token punctuation">.</span>one_hot<span class="token punctuation">(</span>y<span class="token punctuation">,</span> depth<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> y<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
train_dataset <span class="token operator">=</span> tf<span class="token punctuation">.</span>data<span class="token punctuation">.</span>Dataset<span class="token punctuation">.</span>from_tensor_slices<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
train_dataset <span class="token operator">=</span> train_dataset<span class="token punctuation">.</span>batch<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>


model <span class="token operator">=</span> keras<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span><span class="token punctuation">[</span> 
    layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

optimizer <span class="token operator">=</span> optimizers<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>learning_rate<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">train_epoch</span><span class="token punctuation">(</span>epoch<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token comment" spellcheck="true"># Step4.loop</span>
    <span class="token keyword">for</span> step<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>train_dataset<span class="token punctuation">)</span><span class="token punctuation">:</span>


        <span class="token keyword">with</span> tf<span class="token punctuation">.</span>GradientTape<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tape<span class="token punctuation">:</span>
            <span class="token comment" spellcheck="true"># [b, 28, 28] => [b, 784]</span>
            x <span class="token operator">=</span> tf<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token operator">*</span><span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment" spellcheck="true"># Step1. compute output</span>
            <span class="token comment" spellcheck="true"># [b, 784] => [b, 10]</span>
            out <span class="token operator">=</span> model<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
            <span class="token comment" spellcheck="true"># Step2. compute loss</span>
            loss <span class="token operator">=</span> tf<span class="token punctuation">.</span>reduce_sum<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>square<span class="token punctuation">(</span>out <span class="token operator">-</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> x<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

        <span class="token comment" spellcheck="true"># Step3. optimize and update w1, w2, w3, b1, b2, b3</span>
        grads <span class="token operator">=</span> tape<span class="token punctuation">.</span>gradient<span class="token punctuation">(</span>loss<span class="token punctuation">,</span> model<span class="token punctuation">.</span>trainable_variables<span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># w' = w - lr * grad</span>
        optimizer<span class="token punctuation">.</span>apply_gradients<span class="token punctuation">(</span>zip<span class="token punctuation">(</span>grads<span class="token punctuation">,</span> model<span class="token punctuation">.</span>trainable_variables<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> step <span class="token operator">%</span> <span class="token number">100</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>epoch<span class="token punctuation">,</span> step<span class="token punctuation">,</span> <span class="token string">'loss:'</span><span class="token punctuation">,</span> loss<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">train</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">for</span> epoch <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

        train_epoch<span class="token punctuation">(</span>epoch<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    train<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="3-tensorflow数据类型"><a href="#3-tensorflow数据类型" class="headerlink" title="3.tensorflow数据类型"></a>3.tensorflow数据类型</h2><p>list -&gt; np.array -&gt; tf.Tensor</p>
<ul>
<li>int,float,double</li>
<li>bool</li>
<li>string</li>
</ul>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#数据类型</span>
tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#int32</span>

tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#float32</span>

tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token number">1.1</span><span class="token punctuation">,</span>dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>int<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#error</span>

tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span>dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>double<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#float64</span>

tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token boolean">True</span><span class="token punctuation">,</span><span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#bool</span>

tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#string</span>

<span class="token comment" spellcheck="true">#属性</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">'cpu'</span><span class="token punctuation">)</span>：
     a <span class="token operator">=</span> tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
a<span class="token punctuation">.</span>devive <span class="token comment" spellcheck="true">#cpu</span>

aa<span class="token operator">=</span>a<span class="token punctuation">.</span>gpu<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#aa gpu</span>

a<span class="token punctuation">.</span>numpy <span class="token comment" spellcheck="true">#返回numpy</span>

a<span class="token punctuation">.</span>ndim <span class="token comment" spellcheck="true">#返回维度</span>

a<span class="token punctuation">.</span>shape <span class="token comment" spellcheck="true">#返回shape</span>

<span class="token comment" spellcheck="true">#判断</span>
a<span class="token operator">=</span>tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

isinstance<span class="token punctuation">(</span>a<span class="token punctuation">.</span>tfTensor<span class="token punctuation">)</span>
tf<span class="token punctuation">.</span>is_tensor<span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#true</span>

a<span class="token punctuation">.</span>dtype <span class="token comment" spellcheck="true">#tf.float32</span>

<span class="token comment" spellcheck="true">#数据类型转换</span>
a<span class="token operator">=</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#([0,1,2,3,4])</span>

a<span class="token punctuation">.</span>dtype <span class="token comment" spellcheck="true">#int64</span>

aa<span class="token operator">=</span>tf<span class="token punctuation">.</span>convert_to_tensor<span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#int64</span>

aa<span class="token operator">=</span>tf<span class="token punctuation">.</span>convert_to_tensor<span class="token punctuation">(</span>a<span class="token punctuation">,</span>dtype<span class="token operator">=</span>int32<span class="token punctuation">)</span>

tf<span class="token punctuation">.</span>cast<span class="token punctuation">(</span>aa<span class="token punctuation">,</span>dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#cast数据类型转换</span>

b<span class="token operator">=</span>tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
tf<span class="token punctuation">.</span>cast<span class="token punctuation">(</span>b<span class="token punctuation">,</span>dtype<span class="token operator">=</span>bool<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#false,true</span>

c<span class="token operator">=</span>tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
c<span class="token punctuation">.</span>trainable <span class="token comment" spellcheck="true">#true </span>

int<span class="token punctuation">(</span>Tesor<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#直接转换 前提标量</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="4-创建tensor"><a href="#4-创建tensor" class="headerlink" title="4.创建tensor"></a>4.创建tensor</h2><pre class="line-numbers language-python"><code class="language-python">tf<span class="token punctuation">.</span>convert_to_tensor<span class="token punctuation">(</span>np<span class="token punctuation">.</span>ones<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#2行3列 元素都为1  dtype=float64</span>

tf<span class="token punctuation">.</span>convert_to_tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#dtype=int32 1维长度为2的data</span>

tf<span class="token punctuation">.</span>convert_to_tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#2行一列 dyype=float32</span>


tf<span class="token punctuation">.</span>zero<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span>，<span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#shape=[]</span>

tf<span class="token punctuation">.</span>zero_like<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
tf<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>a<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">#等同</span>


tf<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#shape=(1,)</span>
tf<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#shape=()</span>
tf<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#shape=(2,)</span>
tf<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
tf<span class="token punctuation">.</span>ones_like<span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">==</span> tf<span class="token punctuation">.</span>ones<span class="token punctuation">(</span>a<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>


tf<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#填充为0</span>

tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>mean<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>stddev<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># mean: 正态分布的均值，默认为0 ,stddev: 正态分布的标准差，默认为1.0</span>

tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>truncated_normal<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>mean<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>stddev<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#截断的正态分布中输出随机值,和一般的正太分布的产生随机数据比起来，这个函数产生的随机数与均值的差距不会超过两倍的标准差，但是一般的别的函数是可能的。</span>

tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>minval<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>maxval<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#均匀分布0~1</span>

idx<span class="token operator">=</span>tf<span class="token punctuation">.</span>range<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
idx<span class="token operator">=</span>tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>suffle<span class="token punctuation">(</span>idx<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#打乱顺序</span>

a<span class="token operator">=</span>tf<span class="token punctuation">.</span>gather<span class="token punctuation">(</span>a<span class="token punctuation">,</span>idx<span class="token punctuation">)</span>
b<span class="token operator">=</span>tf<span class="token punctuation">.</span>gather<span class="token punctuation">(</span>b<span class="token punctuation">.</span>idx<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#用于有对应关系的数据</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>DIM:<br>NPL [b,seq_len,word_dim] #b句 句长 字维度</p>
<p>IMAGE [b,h,w,c] #4维 b张图片 high wight rgb通道</p>
<h2 id="5-索引与切片"><a href="#5-索引与切片" class="headerlink" title="5. 索引与切片"></a>5. 索引与切片</h2><pre class="line-numbers language-python"><code class="language-python">a<span class="token operator">=</span>tf<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">#shape(5,3) num=1</span>
a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">#shape(3,)</span>
a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">#shape()</span>


a<span class="token operator">=</span>tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#image</span>
a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shape <span class="token comment" spellcheck="true">#[28,28,3]</span>
a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shape <span class="token comment" spellcheck="true">#[28,3]</span>
a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shape <span class="token comment" spellcheck="true"># [3]</span>
a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shape <span class="token comment" spellcheck="true"># []</span>

a<span class="token operator">=</span>tf<span class="token punctuation">.</span>range<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
a<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">#[9]</span>
a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">#[0,1]</span>

a<span class="token punctuation">.</span>shape <span class="token comment" spellcheck="true">#([4,28,28,3])</span>
a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">#([4,28,28]) 所有图片第一个rgb通道</span>

<span class="token comment" spellcheck="true">#strat:end:step</span>
<span class="token comment" spellcheck="true">#::step</span>
a<span class="token punctuation">.</span>tf<span class="token punctuation">.</span>range<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">#倒序3,2,1,0</span>
a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">#3,1</span>
a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">#2,0</span>

a<span class="token operator">=</span>tf<span class="token punctuation">.</span>randommnormal<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#task</span>
a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shape <span class="token operator">==</span>a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>


<span class="token comment" spellcheck="true">#scores [4,35,8] 4个班 35学生 8门成绩</span>
tf<span class="token punctuation">.</span>gather<span class="token punctuation">(</span>a<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>indices<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

tf<span class="token punctuation">.</span>gather_nd<span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape <span class="token comment" spellcheck="true">#0班第1人第2门成绩 []</span>
tf<span class="token punctuation">.</span>gather_nd<span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape <span class="token comment" spellcheck="true"># [1]</span>

tf<span class="token punctuation">.</span>boolean_mask<span class="token punctuation">(</span>a<span class="token punctuation">,</span>mask<span class="token operator">=</span><span class="token punctuation">[</span><span class="token boolean">True</span><span class="token punctuation">,</span><span class="token boolean">True</span><span class="token punctuation">,</span><span class="token boolean">False</span><span class="token punctuation">,</span><span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="6-维度变换"><a href="#6-维度变换" class="headerlink" title="6.维度变换"></a>6.维度变换</h2><p>view<br>[b,28,28]<br>-&gt; [b,28<em>28]<br>-&gt; [b,2,14</em>28]<br>-&gt; [b,28,28,1]</p>
<p>content:[b,h,w,c] [batch,height,width,channel]</p>
<p>image:[4,28,28,3] view=content(h,w)</p>
<p>reshape to:[4,784,3]</p>
<p>[4,784,3] —height28,width28—-&gt; [4,28,28,3]</p>
<p><strong>tf.reshape</strong></p>
<pre class="line-numbers language-python"><code class="language-python">a<span class="token operator">=</span>tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#view1</span>
a<span class="token punctuation">.</span>shape<span class="token punctuation">,</span>a<span class="token punctuation">.</span>ndim <span class="token comment" spellcheck="true">#[4,28,28,3] , 4</span>
tf<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">784</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> tf<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># view2</span>
tf<span class="token punctuation">.</span>rehsape<span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">784</span><span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> tf<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>s<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#view1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>tf.transpose</strong></p>
<pre class="line-numbers language-python"><code class="language-python">a<span class="token operator">=</span>tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
tf<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">.</span>shape <span class="token comment" spellcheck="true">#([1,2,3,4])</span>
tf<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span>a<span class="token punctuation">,</span>perm<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#([4,3,1,2])</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>Squeeze and Expand dim</strong></p>
<pre class="line-numbers language-python"><code class="language-python">a<span class="token operator">=</span>tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">35</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
tf<span class="token punctuation">.</span>expand_dims<span class="token punctuation">(</span>a<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape <span class="token comment" spellcheck="true">#([1,4,35,8])</span>
tf<span class="token punctuation">.</span>expand_dims<span class="token punctuation">(</span>a<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape <span class="token comment" spellcheck="true">#([4,35,8,1])</span>
tf<span class="token punctuation">.</span>expand_dims<span class="token punctuation">(</span>a<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape <span class="token comment" spellcheck="true">#([4,35,8,1])</span>
tf<span class="token punctuation">.</span>expand_dims<span class="token punctuation">(</span>a<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape <span class="token comment" spellcheck="true">#([1,4,35,8])</span>

tf<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape <span class="token comment" spellcheck="true">#([2,3])</span>
a<span class="token operator">=</span>tf<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
tf<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span>a<span class="token punctuation">.</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape <span class="token comment" spellcheck="true">#([2,1,3])</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="7-Broadcasting"><a href="#7-Broadcasting" class="headerlink" title="7.Broadcasting"></a>7.Broadcasting</h2><p>KEY IDEA<br>-Insert 1 dim ahead if needed<br>-Expand dims with size 1 to same size<br>扩张成同一shape进行运算，实际扩张部分没有数据。<br>右对齐<br>节省内存</p>
<pre class="line-numbers language-python"><code class="language-python">x<span class="token operator">=</span>tf<span class="token punctuation">,</span>random<span class="token punctuation">,</span>normal<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span>x<span class="token operator">+</span>tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape <span class="token comment" spellcheck="true">#([4,32,32,3])</span>
<span class="token punctuation">(</span>x<span class="token operator">+</span>tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape <span class="token comment" spellcheck="true">#([4,32,32,3])</span>
<span class="token punctuation">(</span>x<span class="token operator">+</span>tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape <span class="token comment" spellcheck="true">#([4,32,32,3])</span>
<span class="token punctuation">(</span>x<span class="token operator">+</span>tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape <span class="token comment" spellcheck="true">#incompatible shape</span>
b<span class="token operator">=</span>tf<span class="token punctuation">.</span>broadcast_to<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="8-数学运算"><a href="#8-数学运算" class="headerlink" title="8.数学运算"></a>8.数学运算</h2><p><strong>element-wise</strong></p>
<pre class="line-numbers language-python"><code class="language-python">b<span class="token operator">=</span>tf<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
a<span class="token operator">=</span>tf<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
a<span class="token operator">+</span>b<span class="token punctuation">,</span>a<span class="token operator">-</span>b<span class="token punctuation">,</span>a<span class="token operator">*</span>b<span class="token punctuation">,</span>a<span class="token operator">/</span>b 
b<span class="token operator">//</span>a<span class="token punctuation">,</span>b<span class="token operator">%</span>a <span class="token comment" spellcheck="true">#整除 取余</span>

a<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
tf<span class="token punctuation">.</span>math<span class="token punctuation">.</span>log<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
tf<span class="token punctuation">.</span>exp<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
tf<span class="token punctuation">.</span>math<span class="token punctuation">.</span>log<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token operator">/</span>tf<span class="token punctuation">.</span>math<span class="token punctuation">.</span>log<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#3</span>

b<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
tf<span class="token punctuation">.</span>pow<span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
b<span class="token operator">**</span><span class="token number">3</span>
tf<span class="token punctuation">.</span>sqpt<span class="token punctuation">(</span>b<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>matrix-wise</strong></p>
<pre class="line-numbers language-python"><code class="language-python">a<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
b<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
a@b <span class="token comment" spellcheck="true">#[[4.,4.,4.,4.]]</span>
tf<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span>


a<span class="token operator">=</span>tf<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
b<span class="token operator">=</span>tf<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
a@b <span class="token comment" spellcheck="true">#shape =[4,2,5]</span>


a<span class="token punctuation">.</span>shape <span class="token comment" spellcheck="true">#[4,2,3]</span>
b<span class="token punctuation">.</span>shape <span class="token comment" spellcheck="true">#[3,5]</span>
bb<span class="token operator">=</span>tf<span class="token punctuation">.</span>broadcast_to<span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
a@b<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="9-前向传播"><a href="#9-前向传播" class="headerlink" title="9.前向传播"></a>9.前向传播</h2><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span>  tensorflow <span class="token keyword">as</span> tf
<span class="token keyword">from</span>    tensorflow <span class="token keyword">import</span> keras
<span class="token keyword">from</span>    tensorflow<span class="token punctuation">.</span>keras <span class="token keyword">import</span> datasets
<span class="token keyword">import</span>  os

os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'TF_CPP_MIN_LOG_LEVEL'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'2'</span> <span class="token comment" spellcheck="true">#消除tensorflow初始化的一些提示</span>

<span class="token comment" spellcheck="true"># x: [60k, 28, 28],</span>
<span class="token comment" spellcheck="true"># y: [60k]</span>
<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> _ <span class="token operator">=</span> datasets<span class="token punctuation">.</span>mnist<span class="token punctuation">.</span>load_data<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># x: [0~255] => [0~1.]</span>
x <span class="token operator">=</span> tf<span class="token punctuation">.</span>convert_to_tensor<span class="token punctuation">(</span>x<span class="token punctuation">,</span> dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">255</span><span class="token punctuation">.</span>
y <span class="token operator">=</span> tf<span class="token punctuation">.</span>convert_to_tensor<span class="token punctuation">(</span>y<span class="token punctuation">,</span> dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>int32<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> y<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> x<span class="token punctuation">.</span>dtype<span class="token punctuation">,</span> y<span class="token punctuation">.</span>dtype<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>tf<span class="token punctuation">.</span>reduce_min<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> tf<span class="token punctuation">.</span>reduce_max<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>tf<span class="token punctuation">.</span>reduce_min<span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> tf<span class="token punctuation">.</span>reduce_max<span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>


train_db <span class="token operator">=</span> tf<span class="token punctuation">.</span>data<span class="token punctuation">.</span>Dataset<span class="token punctuation">.</span>from_tensor_slices<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>batch<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span>
train_iter <span class="token operator">=</span> iter<span class="token punctuation">(</span>train_db<span class="token punctuation">)</span>
sample <span class="token operator">=</span> next<span class="token punctuation">(</span>train_iter<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'batch:'</span><span class="token punctuation">,</span> sample<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shape<span class="token punctuation">,</span> sample<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span>


<span class="token comment" spellcheck="true"># [b, 784] => [b, 256] => [b, 128] => [b, 10]</span>
<span class="token comment" spellcheck="true"># [dim_in, dim_out], [dim_out]</span>
w1 <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>truncated_normal<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">784</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">,</span> stddev<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
b1 <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
w2 <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>truncated_normal<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">]</span><span class="token punctuation">,</span> stddev<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
b2 <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
w3 <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>truncated_normal<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span> stddev<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
b3 <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

lr <span class="token operator">=</span> <span class="token number">1e</span><span class="token operator">-</span><span class="token number">3</span>

<span class="token keyword">for</span> epoch <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># iterate db for 10</span>
    <span class="token keyword">for</span> step<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>train_db<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># for every batch</span>
        <span class="token comment" spellcheck="true"># x:[128, 28, 28]</span>
        <span class="token comment" spellcheck="true"># y: [128]</span>

        <span class="token comment" spellcheck="true"># [b, 28, 28] => [b, 28*28]</span>
        x <span class="token operator">=</span> tf<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token operator">*</span><span class="token number">28</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

        <span class="token keyword">with</span> tf<span class="token punctuation">.</span>GradientTape<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tape<span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># tf.Variable</span>
            <span class="token comment" spellcheck="true"># x: [b, 28*28]</span>
            <span class="token comment" spellcheck="true"># h1 = x@w1 + b1</span>
            <span class="token comment" spellcheck="true"># [b, 784]@[784, 256] + [256] => [b, 256] + [256] => [b, 256] + [b, 256]</span>
            h1 <span class="token operator">=</span> x@w1 <span class="token operator">+</span> tf<span class="token punctuation">.</span>broadcast_to<span class="token punctuation">(</span>b1<span class="token punctuation">,</span> <span class="token punctuation">[</span>x<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            h1 <span class="token operator">=</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>h1<span class="token punctuation">)</span>
            <span class="token comment" spellcheck="true"># [b, 256] => [b, 128]</span>
            h2 <span class="token operator">=</span> h1@w2 <span class="token operator">+</span> b2
            h2 <span class="token operator">=</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>h2<span class="token punctuation">)</span>
            <span class="token comment" spellcheck="true"># [b, 128] => [b, 10]</span>
            out <span class="token operator">=</span> h2@w3 <span class="token operator">+</span> b3

            <span class="token comment" spellcheck="true"># compute loss</span>
            <span class="token comment" spellcheck="true"># out: [b, 10]</span>
            <span class="token comment" spellcheck="true"># y: [b] => [b, 10]</span>
            y_onehot <span class="token operator">=</span> tf<span class="token punctuation">.</span>one_hot<span class="token punctuation">(</span>y<span class="token punctuation">,</span> depth<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>

            <span class="token comment" spellcheck="true"># mse = mean(sum(y-out)^2)</span>
            <span class="token comment" spellcheck="true"># [b, 10]</span>
            loss <span class="token operator">=</span> tf<span class="token punctuation">.</span>square<span class="token punctuation">(</span>y_onehot <span class="token operator">-</span> out<span class="token punctuation">)</span>
            <span class="token comment" spellcheck="true"># mean: scalar</span>
            loss <span class="token operator">=</span> tf<span class="token punctuation">.</span>reduce_mean<span class="token punctuation">(</span>loss<span class="token punctuation">)</span>

        <span class="token comment" spellcheck="true"># compute gradients</span>
        grads <span class="token operator">=</span> tape<span class="token punctuation">.</span>gradient<span class="token punctuation">(</span>loss<span class="token punctuation">,</span> <span class="token punctuation">[</span>w1<span class="token punctuation">,</span> b1<span class="token punctuation">,</span> w2<span class="token punctuation">,</span> b2<span class="token punctuation">,</span> w3<span class="token punctuation">,</span> b3<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># print(grads)</span>
        <span class="token comment" spellcheck="true"># w1 = w1 - lr * w1_grad</span>
        w1<span class="token punctuation">.</span>assign_sub<span class="token punctuation">(</span>lr <span class="token operator">*</span> grads<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        b1<span class="token punctuation">.</span>assign_sub<span class="token punctuation">(</span>lr <span class="token operator">*</span> grads<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        w2<span class="token punctuation">.</span>assign_sub<span class="token punctuation">(</span>lr <span class="token operator">*</span> grads<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        b2<span class="token punctuation">.</span>assign_sub<span class="token punctuation">(</span>lr <span class="token operator">*</span> grads<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        w3<span class="token punctuation">.</span>assign_sub<span class="token punctuation">(</span>lr <span class="token operator">*</span> grads<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        b3<span class="token punctuation">.</span>assign_sub<span class="token punctuation">(</span>lr <span class="token operator">*</span> grads<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


        <span class="token keyword">if</span> step <span class="token operator">%</span> <span class="token number">100</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>epoch<span class="token punctuation">,</span> step<span class="token punctuation">,</span> <span class="token string">'loss:'</span><span class="token punctuation">,</span> float<span class="token punctuation">(</span>loss<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="10-合并与分割"><a href="#10-合并与分割" class="headerlink" title="10.合并与分割"></a>10.合并与分割</h2><p><strong>tf.concat / tf.stack</strong></p>
<pre class="line-numbers language-python"><code class="language-python">a<span class="token operator">=</span>tf<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
b<span class="token operator">=</span>tf<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
c<span class="token operator">=</span>tf<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>a<span class="token punctuation">,</span>b<span class="token punctuation">]</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
c<span class="token punctuation">.</span>shape <span class="token comment" spellcheck="true"># ([4,35,8])</span>

tf<span class="token punctuation">.</span>stack<span class="token punctuation">(</span><span class="token punctuation">[</span>a<span class="token punctuation">,</span>b<span class="token punctuation">]</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># error 所有维度都相等</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>tf.unstack / tf.split</strong> </p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#[2,4,35,8]</span>
res<span class="token operator">=</span>tf<span class="token punctuation">.</span>unstack<span class="token punctuation">(</span>c<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#打散</span>
len<span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#8</span>

res<span class="token operator">=</span>tf<span class="token punctuation">.</span>split<span class="token punctuation">(</span>c<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>num_or_size_splits<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
len<span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#2</span>
res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shape <span class="token comment" spellcheck="true">#[2,4,35,4]</span>

res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>tf<span class="token punctuation">.</span>split<span class="token punctuation">(</span>c<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>num_or_size_splits<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shape<span class="token punctuation">,</span>res<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shape <span class="token comment" spellcheck="true">#[2,4,35,2] [2,4,35,4]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="11-数据统计"><a href="#11-数据统计" class="headerlink" title="11.数据统计"></a>11.数据统计</h2><p><strong>Vector Norm 范数</strong><br>-Eukl.Norm=sqrt(sum(xi**2))  #2范数 xi平方和开根号<br>-Max.norm=max(abs(xi)) #正无穷范数 向量的所有元素的绝对值中最大的<br>-L1-Norm=sum(abs(xi)) #1范数 元素绝对值和</p>
<pre class="line-numbers language-python"><code class="language-python">a<span class="token operator">=</span>tf<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
tf<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#2范数 2</span>
<span class="token operator">==</span>tf<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>reduce_sum<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>square<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

a<span class="token operator">=</span>tf<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
tf<span class="token punctuation">.</span>norm <span class="token comment" spellcheck="true">#96.99484</span>

b<span class="token operator">=</span>tf<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
tf<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#2</span>
tf<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>b<span class="token punctuation">,</span>ord<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#axis=1 行   [sqrt(2),sqrt(2)]</span>
tf<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>b<span class="token punctuation">,</span>ord<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#1范数 4</span>
tf<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>b<span class="token punctuation">,</span>ord<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#1范数 列 [2,2]</span>
tf<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>b<span class="token punctuation">.</span>ord<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>reduce_min/max/mean</strong> </p>
<pre class="line-numbers language-python"><code class="language-python">a<span class="token operator">=</span>tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
tf<span class="token punctuation">.</span>reduce_min<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
tf<span class="token punctuation">.</span>reduce_max<span class="token punctuation">(</span>a<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>argmax/argmin</strong> #最大最小值的位置</p>
<pre class="line-numbers language-python"><code class="language-python">a<span class="token punctuation">.</span>shape <span class="token comment" spellcheck="true">#([4,10])</span>
tf<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">.</span>shape <span class="token comment" spellcheck="true">#axis默认为0, [10]</span>
tf<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>tf.equal</strong></p>
<pre class="line-numbers language-python"><code class="language-python">a<span class="token operator">=</span>tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
b<span class="token operator">=</span>tf<span class="token punctuation">.</span>range<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
tf<span class="token punctuation">.</span>equal<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#[False,False,False,True,False]</span>
res<span class="token operator">=</span>tf<span class="token punctuation">.</span>equal<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span>
tf<span class="token punctuation">.</span>reduce_sum<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>cast<span class="token punctuation">(</span>res<span class="token punctuation">,</span>dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>int32<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#numpy=1</span>

<span class="token comment" spellcheck="true">#accuracy</span>
a<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0.1</span><span class="token punctuation">,</span><span class="token number">0.2</span><span class="token punctuation">,</span><span class="token number">0.7</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0.9</span><span class="token punctuation">,</span><span class="token number">0.05</span><span class="token punctuation">,</span><span class="token number">0.05</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
pred<span class="token operator">=</span>tf<span class="token punctuation">.</span>cast<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>a<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>int32<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#[2,0]</span>
y<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span>
tf<span class="token punctuation">.</span>equal<span class="token punctuation">(</span>y<span class="token punctuation">,</span>pred<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#[True,False]</span>
correct<span class="token operator">=</span>tf<span class="token punctuation">.</span>reduce_sum<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>cast<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>equal<span class="token punctuation">(</span>y<span class="token punctuation">,</span>pred<span class="token punctuation">)</span><span class="token punctuation">,</span>dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>int32<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#1</span>
correct<span class="token operator">/</span><span class="token number">2</span> <span class="token comment" spellcheck="true">#0.5</span>
```python
<span class="token operator">**</span>tf<span class="token punctuation">,</span>unique<span class="token operator">**</span>
a<span class="token operator">=</span>tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
tf<span class="token punctuation">.</span>unique<span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#消去重复[4,2,3]  原始索引[0,1,1,0,2]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="12-张量排序"><a href="#12-张量排序" class="headerlink" title="12.张量排序"></a>12.张量排序</h2><p><strong>Sort/argsort</strong></p>
<pre class="line-numbers language-python"><code class="language-python">a<span class="token operator">=</span>tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>suffle<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>range<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#[2,0,3,4,1]</span>
tf<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>a<span class="token punctuation">,</span>direction<span class="token operator">=</span><span class="token string">'DESCENGING'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#[4,3,2,1,0]</span>
tf<span class="token punctuation">.</span>argsort<span class="token punctuation">(</span>a<span class="token punctuation">,</span>direction<span class="token operator">=</span><span class="token string">'DESCENGING'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#[3,2,0,4,1]</span>
idx<span class="token operator">=</span>tf<span class="token punctuation">.</span>argsort<span class="token punctuation">(</span>a<span class="token punctuation">,</span>direction<span class="token operator">=</span><span class="token string">'DESCENGING'</span><span class="token punctuation">)</span>
tf<span class="token punctuation">.</span>gather<span class="token punctuation">(</span>a<span class="token punctuation">,</span>idx<span class="token punctuation">)</span>

a<span class="token operator">=</span>tf<span class="token punctuation">.</span>ranfom<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>maxval<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>int32<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#[[4,6,8],[9,4,7],[4,5,1]]</span>
tf<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#默认升序 [[4,6,8],[4,7,9],[1,4,5]]</span>
tf<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>a<span class="token punctuation">,</span>direction<span class="token operator">=</span><span class="token string">'DESCENFING'</span><span class="token punctuation">)</span>
idx<span class="token operator">=</span>tf<span class="token punctuation">.</span>argsort<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>Top_k</strong></p>
<pre class="line-numbers language-python"><code class="language-python">a<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
res<span class="token operator">=</span>tf<span class="token punctuation">.</span>math<span class="token punctuation">.</span>top_k<span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">#前两个最大值</span>
res<span class="token punctuation">.</span>indices <span class="token comment" spellcheck="true">#[[2,1],[0,2],[1,0]]</span>
res<span class="token punctuation">.</span>values <span class="token comment" spellcheck="true">#[[8,6][9,7],[5,4]]</span>

<span class="token comment" spellcheck="true">#accuracy</span>
prob<span class="token operator">=</span>tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.1</span><span class="token punctuation">,</span><span class="token number">0.2</span><span class="token punctuation">,</span><span class="token number">0.7</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0.2</span><span class="token punctuation">,</span><span class="token number">0.7</span><span class="token punctuation">,</span><span class="token number">0.1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
k_b<span class="token operator">=</span>tf<span class="token punctuation">.</span>mah<span class="token punctuation">.</span>top_k<span class="token punctuation">(</span>prob<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>indices <span class="token comment" spellcheck="true">#[[2,1,0],[1,0,2]]</span>
k_b<span class="token operator">=</span>tf<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span>k_b<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#[[2,1],[1,0],[0,2]]</span>
target<span class="token operator">=</span>tf<span class="token punctuation">.</span>broadcast_to<span class="token punctuation">(</span>target<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#top_k accuracy</span>
<span class="token keyword">def</span> <span class="token function">accuracy</span><span class="token punctuation">(</span>output<span class="token punctuation">,</span> target<span class="token punctuation">,</span> topk<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    maxk <span class="token operator">=</span> max<span class="token punctuation">(</span>topk<span class="token punctuation">)</span>
    batch_size <span class="token operator">=</span> target<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

    pred <span class="token operator">=</span> tf<span class="token punctuation">.</span>math<span class="token punctuation">.</span>top_k<span class="token punctuation">(</span>output<span class="token punctuation">,</span> maxk<span class="token punctuation">)</span><span class="token punctuation">.</span>indices
    pred <span class="token operator">=</span> tf<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span>pred<span class="token punctuation">,</span> perm<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    target_ <span class="token operator">=</span> tf<span class="token punctuation">.</span>broadcast_to<span class="token punctuation">(</span>target<span class="token punctuation">,</span> pred<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
    correct <span class="token operator">=</span> tf<span class="token punctuation">.</span>equal<span class="token punctuation">(</span>pred<span class="token punctuation">,</span> target_<span class="token punctuation">)</span>

    res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> k <span class="token keyword">in</span> topk<span class="token punctuation">:</span>
        correct_k <span class="token operator">=</span> tf<span class="token punctuation">.</span>cast<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>correct<span class="token punctuation">[</span><span class="token punctuation">:</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
        correct_k <span class="token operator">=</span> tf<span class="token punctuation">.</span>reduce_sum<span class="token punctuation">(</span>correct_k<span class="token punctuation">)</span>
        acc <span class="token operator">=</span> float<span class="token punctuation">(</span>correct_k<span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">100.0</span> <span class="token operator">/</span> batch_size<span class="token punctuation">)</span> <span class="token punctuation">)</span>
        res<span class="token punctuation">.</span>append<span class="token punctuation">(</span>acc<span class="token punctuation">)</span>

    <span class="token keyword">return</span> res<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="13-填充与复制"><a href="#13-填充与复制" class="headerlink" title="13.填充与复制"></a>13.填充与复制</h2><p><strong>pad</strong></p>
<pre class="line-numbers language-python"><code class="language-python">a<span class="token operator">=</span>tf<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>range<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#[[0,1,2],[3,4,5],[6,7,8]]</span>
tf<span class="token punctuation">.</span>pad<span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#[[上，下]，[左，右]] 左边扩张一列默认为0</span>

<span class="token comment" spellcheck="true">#image padding</span>
a<span class="token operator">=</span>tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>noraml<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
b<span class="token operator">=</span>tf<span class="token punctuation">.</span>pad<span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
b<span class="token punctuation">.</span>shape <span class="token comment" spellcheck="true">#[4,32,32,3]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>tile</strong>复制</p>
<pre class="line-numbers language-python"><code class="language-python">a<span class="token punctuation">.</span>shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span>
b<span class="token operator">=</span>tf<span class="token punctuation">.</span>tile<span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#[行，列] 1保持不变 2列维度变为两倍</span>
b<span class="token punctuation">.</span>shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>tile VS broadcast_to</p>
<h2 id="14-张量限幅"><a href="#14-张量限幅" class="headerlink" title="14.张量限幅"></a>14.张量限幅</h2><p><strong>clip_by_value</strong>  Relu</p>
<pre class="line-numbers language-python"><code class="language-python">a<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">]</span>
tf<span class="token punctuation">.</span>maximum<span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#[2,2,2,3,4,5,6,7,8,9]</span>
tf<span class="token punctuation">.</span>minimum<span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#[0,1,2,3,4,5,6,7,8,8]</span>
tf<span class="token punctuation">.</span>clip_by_value<span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#[2,2,2,3,4,5,6,7,8,8]</span>

a<span class="token operator">=</span>a<span class="token number">-5</span> <span class="token comment" spellcheck="true">#[-5,-4,-3,-2,-1,0,1,2,3,4]</span>
tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#[0,0,0,0,0,0,1,2,3,4]</span>
<span class="token operator">==</span>tf<span class="token punctuation">.</span>maxmum<span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>clip_by_nrom</strong>根据范数 等比例缩小</p>
<pre class="line-numbers language-python"><code class="language-python">a<span class="token operator">=</span>tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>mean<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
tf<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
aa<span class="token operator">=</span>tf<span class="token punctuation">.</span>clip_by_norm<span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">)</span>
tf<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>aa<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#范数=15</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>梯度爆炸(Gradiet Exploding) 单次步长过长 造成loss震荡<br>梯度消失(Gradiet vanishing)  单次步长过小 造成loss降不下去<br>保证梯度方向不变 [w1,w2,w3]同时变化<br>new_grads,total_norm=tf.clip_by_global_norm(grads,25) #保持整体norm=25</p>
<h2 id="15-高级操作"><a href="#15-高级操作" class="headerlink" title="15.高级操作"></a>15.高级操作</h2><p><strong>Where(tensor)</strong></p>
<pre class="line-numbers language-python"><code class="language-python">a<span class="token operator">=</span>tf<span class="token punctuation">.</span>random<span class="token punctuation">,</span>normal<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
mask<span class="token operator">=</span>a<span class="token operator">></span><span class="token number">0</span> <span class="token comment" spellcheck="true">#shape=3x3 value=true or false</span>
tf<span class="token punctuation">.</span>boolean_mask<span class="token punctuation">(</span>a<span class="token punctuation">,</span>mask<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#返回值ture的具体值 == tf.gather_nd(a,indices)</span>
indices<span class="token operator">=</span>tf<span class="token punctuation">.</span>where<span class="token punctuation">(</span>mask<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#返回值为true的坐标 </span>


mask <span class="token comment" spellcheck="true">#[[T,T,F],[T,F,F],[T,T,F]]</span>
A<span class="token operator">=</span>tf<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
B<span class="token operator">=</span>tf<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
tf<span class="token punctuation">.</span>whera<span class="token punctuation">(</span>mask<span class="token punctuation">,</span>A<span class="token punctuation">,</span>B<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#[[1,1,0],[1,0,0],[1,1,0]]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>scatter_nd</strong><br>只用于全0的底板进行更新</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#一维更新</span>
indices<span class="token operator">=</span>tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
updates<span class="token operator">-</span>tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span>
shape<span class="token operator">=</span>tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#1x8 全为0</span>

tf<span class="token punctuation">.</span>scatter_nd<span class="token punctuation">(</span>indices<span class="token punctuation">,</span>updates<span class="token punctuation">,</span>shape<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#[0.11,0,10,9,0,0,12]</span>

<span class="token comment" spellcheck="true">#多维更新同理</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>meshgrid</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#numpy</span>
points<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> y <span class="token keyword">in</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">for</span> x <span class="token keyword">in</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    points<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span>y<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">return</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>points<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#tf</span>
y<span class="token operator">=</span>tf<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
x<span class="token operator">=</span>tf<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
points_x<span class="token punctuation">,</span>points_y<span class="token operator">=</span>tf<span class="token punctuation">.</span>meshgrid<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span>
points_x<span class="token punctuation">.</span>shape <span class="token comment" spellcheck="true">#[5,5]</span>
points_x <span class="token comment" spellcheck="true">#所有点x部分</span>
points_y <span class="token comment" spellcheck="true">#所有点y部分</span>
points<span class="token operator">=</span>tf<span class="token punctuation">.</span>stack<span class="token punctuation">(</span><span class="token punctuation">[</span>points_x<span class="token punctuation">,</span>points_y<span class="token punctuation">]</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#绘制三维图</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="16-数据加载"><a href="#16-数据加载" class="headerlink" title="16.数据加载"></a>16.数据加载</h2><p><strong>keras.datasets</strong></p>
<ul>
<li>boston housing</li>
<li>mnist/fashion mnist</li>
<li>cifar10/100</li>
<li>imdb #nlp<pre class="line-numbers language-python"><code class="language-python"><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>x_test<span class="token punctuation">,</span>y_test<span class="token punctuation">)</span><span class="token operator">=</span>keras<span class="token punctuation">.</span>datasets<span class="token punctuation">.</span>mnist<span class="token punctuation">.</span>load_data<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#numpy</span>
x<span class="token punctuation">.</span>shaoe <span class="token comment" spellcheck="true">#(60000,28,28)</span>
y<span class="token punctuation">.</span>shape <span class="token comment" spellcheck="true">#(60000,)  0-9</span>
x<span class="token punctuation">.</span>min<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>x<span class="token punctuation">.</span>max<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#0 ,255</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ul>
<p>y[:2] #[5,0]<br>y_onehot=tf.one_hot(y,depth=10)<br>y_onehot[:2] #[[0,0,0,0,0,1,0,0,0,0],[1,0,0,0,0,0,0,0,0,]]</p>
<pre><code>**tf.data.Dataset** #转换为tensor
```python
(x,y),(x_test,y_test)=keras.datasets.cifar10.load_data()
#50k   10k
db=tf.data.Dataset.from_tensor_slice(x_test，y_test)
next(iter(db))[0].shape #tensor [32,32,3]

#shuffle 随机打散
db=db.shuffle(10000)

#数据预处理
def preprocess(x,y):
    x=tf.cast(x,dtype=tf.float32)/255  #变为0-1
    y=tf.cast(y,dtype=tf.int32)
    y=tf.one_hot(y,depth=10)
    return x,y

db2=db.map(preprocess)
res=next(iter(db2))
res[0].shape,res[1].shape #tensor [32,32,3]  [1,10]


db3=db2.batch(32)
res=next(iter(db3))
res[0].shape,res[1].shape #tensor [32,32,32,3]  [32,1,10]

db4=db3.repeat(2)</code></pre><p>标准预处理流程</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">preprocess</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    x<span class="token operator">=</span>tf<span class="token punctuation">.</span>cast<span class="token punctuation">(</span>x<span class="token punctuation">,</span>dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">255</span>  <span class="token comment" spellcheck="true">#变为0-1</span>
    y<span class="token operator">=</span>tf<span class="token punctuation">.</span>cast<span class="token punctuation">(</span>y<span class="token punctuation">,</span>dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>int32<span class="token punctuation">)</span>
    <span class="token keyword">return</span> x<span class="token punctuation">,</span>y

<span class="token keyword">def</span> <span class="token function">minst_dataset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>x_test<span class="token punctuation">,</span>y_test<span class="token punctuation">)</span><span class="token operator">=</span>keras<span class="token punctuation">.</span>datasets<span class="token punctuation">.</span>fashion_mnist<span class="token punctuation">.</span>load_data<span class="token punctuation">(</span><span class="token punctuation">)</span>
    y<span class="token operator">=</span>tf<span class="token punctuation">.</span>one_hot<span class="token punctuation">(</span>y<span class="token punctuation">,</span>depth<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
    y_test <span class="token operator">=</span>tf<span class="token punctuation">.</span>one_hot<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span>depth<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>

    ds<span class="token operator">=</span>tf<span class="token punctuation">.</span>data<span class="token punctuation">.</span>Dataset<span class="token punctuation">.</span>from_tensor_slice<span class="token punctuation">(</span>x，y<span class="token punctuation">)</span>
    ds<span class="token operator">=</span>ds<span class="token punctuation">.</span>map<span class="token punctuation">(</span>preprocess<span class="token punctuation">)</span>
    ds<span class="token operator">=</span>ds<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span><span class="token number">60000</span><span class="token punctuation">)</span><span class="token punctuation">.</span>batch<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
    ds_test<span class="token operator">=</span>tf<span class="token punctuation">.</span>data<span class="token punctuation">.</span>Dataset<span class="token punctuation">.</span>from_tensor_slice<span class="token punctuation">(</span>x_test，y_test<span class="token punctuation">)</span>
    ds_test<span class="token operator">=</span>ds<span class="token punctuation">.</span>map<span class="token punctuation">(</span>preprocess<span class="token punctuation">)</span>
    ds_test<span class="token operator">=</span>ds<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span><span class="token number">60000</span><span class="token punctuation">)</span><span class="token punctuation">.</span>batch<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> ds<span class="token punctuation">,</span>ds_test<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="17-全连接层"><a href="#17-全连接层" class="headerlink" title="17.全连接层"></a>17.全连接层</h2><p>矩阵运算 转换为 全连接层包括input hidden output<br>神经元x  连接w</p>
<pre class="line-numbers language-python"><code class="language-python">x<span class="token operator">=</span>tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">784</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

net<span class="token operator">=</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span>
out<span class="token operator">=</span>net<span class="token punctuation">(</span>x<span class="token punctuation">)</span>

out<span class="token punctuation">.</span>shape <span class="token comment" spellcheck="true">#9=([4,521])</span>
net<span class="token punctuation">.</span>kernel<span class="token punctuation">.</span>shape<span class="token punctuation">,</span>net<span class="token punctuation">.</span>bias<span class="token punctuation">.</span>shape <span class="token comment" spellcheck="true">#[784,512],[512]</span>

<span class="token comment" spellcheck="true">#Multi-layers</span>
model<span class="token operator">=</span>keras<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf 
<span class="token keyword">from</span>     tensorflow <span class="token keyword">import</span> keras

x <span class="token operator">=</span> tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

model <span class="token operator">=</span> keras<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span><span class="token punctuation">[</span>
        keras<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        keras<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        keras<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>build<span class="token punctuation">(</span>input_shape<span class="token operator">=</span><span class="token punctuation">[</span>None<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>summary<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> p <span class="token keyword">in</span> model<span class="token punctuation">.</span>trainable_variables<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>name<span class="token punctuation">,</span> p<span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="18-输出方式"><a href="#18-输出方式" class="headerlink" title="18.输出方式"></a>18.输出方式</h2><p>tf.sigmoid() 压缩到0-1<br>tf.nn.softmax()  e的yi方/sum(e的yi方) 压缩到总概率和为1<br>tf.tanh 压缩到(-1,1)</p>
<h2 id="19-损失函数"><a href="#19-损失函数" class="headerlink" title="19.损失函数"></a>19.损失函数</h2><p><strong>MSE</strong>  (Mean Squaared Error 均方差) loss=1/N sum((y-out)**2)</p>
<pre class="line-numbers language-python"><code class="language-python">y<span class="token operator">=</span>tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
y<span class="token operator">=</span>tf<span class="token punctuation">.</span>one_hot<span class="token punctuation">(</span>y<span class="token punctuation">,</span>depth<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
y<span class="token operator">=</span>tf<span class="token punctuation">.</span>cast<span class="token punctuation">(</span>y<span class="token punctuation">,</span>dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>

out<span class="token operator">=</span>tf<span class="token punctuation">.</span>ranfom<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
loss1<span class="token operator">=</span>tf<span class="token punctuation">.</span>reduce_mean<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>square<span class="token punctuation">(</span>y<span class="token operator">-</span>out<span class="token punctuation">)</span><span class="token punctuation">)</span>
loss2<span class="token operator">=</span>tf<span class="token punctuation">.</span>square<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>y<span class="token operator">-</span>out<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">)</span>
loss3<span class="token operator">=</span>tf<span class="token punctuation">.</span>reduce_mean<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>losses<span class="token punctuation">.</span>MSE<span class="token punctuation">(</span>y<span class="token punctuation">,</span>out<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>Entropy</strong> 数字大，稳定   数字小，不均等</p>
<pre class="line-numbers language-python"><code class="language-python">a<span class="token operator">=</span>tf<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">0.25</span><span class="token punctuation">)</span>
a<span class="token operator">=</span>tf<span class="token punctuation">.</span>math<span class="token punctuation">.</span>log<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token operator">/</span>tf<span class="token punctuation">.</span>mat<span class="token punctuation">.</span>log<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#PlogP</span>
tf<span class="token punctuation">.</span>reduce_sum<span class="token punctuation">(</span>a<span class="token operator">*</span>tf<span class="token punctuation">.</span>matf<span class="token punctuation">.</span>log<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token operator">/</span>tf<span class="token punctuation">.</span>math<span class="token punctuation">.</span>log<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">#2</span>

a<span class="token operator">=</span>tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.1</span><span class="token punctuation">,</span><span class="token number">0.1</span><span class="token punctuation">,</span><span class="token number">0.1</span><span class="token punctuation">,</span><span class="token number">0.7</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
tf<span class="token punctuation">.</span>reduce_sum<span class="token punctuation">(</span>a<span class="token operator">*</span>tf<span class="token punctuation">.</span>matf<span class="token punctuation">.</span>log<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token operator">/</span>tf<span class="token punctuation">.</span>math<span class="token punctuation">.</span>log<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">#1.35677</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>Cross Entropy</strong>交叉熵</p>
<pre class="line-numbers language-python"><code class="language-python">tf<span class="token punctuation">.</span>losser<span class="token punctuation">.</span>categorical_crossentrop<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0.25</span><span class="token punctuation">,</span><span class="token number">0.25</span><span class="token punctuation">,</span><span class="token number">0.25</span><span class="token punctuation">,</span><span class="token number">0.25</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
criteon<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0.1</span><span class="token punctuation">,</span><span class="token number">0.7</span><span class="token punctuation">,</span><span class="token number">0.1</span><span class="token punctuation">,</span><span class="token number">0.1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
tf<span class="token punctuation">.</span>losses<span class="token punctuation">.</span>BinaryCrossentropy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0.1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

tf<span class="token punctuation">.</span>losses<span class="token punctuation">.</span>categorical_crossentrop<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>logits<span class="token punctuation">,</span>from_logits<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="20-梯度下降"><a href="#20-梯度下降" class="headerlink" title="20.梯度下降"></a>20.梯度下降</h2><p>梯度方向代表函数增大的方向 </p>
<pre class="line-numbers language-python"><code class="language-python">w<span class="token operator">=</span>tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
x<span class="token operator">=</span>tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
With tf<span class="token punctuation">.</span>GradientTape<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tape<span class="token punctuation">:</span>
    tape<span class="token punctuation">.</span>watch<span class="token punctuation">(</span><span class="token punctuation">[</span>w<span class="token punctuation">]</span><span class="token punctuation">)</span>
    y2<span class="token operator">=</span>x<span class="token operator">*</span>w
grda2<span class="token operator">=</span>tape<span class="token punctuation">.</span>gradient<span class="token punctuation">(</span>y2<span class="token punctuation">,</span><span class="token punctuation">[</span>w<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#2</span>

With tf<span class="token punctuation">.</span>GradientTape<span class="token punctuation">(</span>persistent<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tape<span class="token punctuation">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="21-函数优化"><a href="#21-函数优化" class="headerlink" title="21.函数优化"></a>21.函数优化</h2><p>Himmelblau function</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span>  numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span>    mpl_toolkits<span class="token punctuation">.</span>mplot3d <span class="token keyword">import</span> Axes3D
<span class="token keyword">from</span>    matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span>  tensorflow <span class="token keyword">as</span> tf



<span class="token keyword">def</span> <span class="token function">himmelblau</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">+</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span>


x <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'x,y range:'</span><span class="token punctuation">,</span> x<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> y<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
X<span class="token punctuation">,</span> Y <span class="token operator">=</span> np<span class="token punctuation">.</span>meshgrid<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'X,Y maps:'</span><span class="token punctuation">,</span> X<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> Y<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
Z <span class="token operator">=</span> himmelblau<span class="token punctuation">(</span><span class="token punctuation">[</span>X<span class="token punctuation">,</span> Y<span class="token punctuation">]</span><span class="token punctuation">)</span>

fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'himmelblau'</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> fig<span class="token punctuation">.</span>gca<span class="token punctuation">(</span>projection<span class="token operator">=</span><span class="token string">'3d'</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>plot_surface<span class="token punctuation">(</span>X<span class="token punctuation">,</span> Y<span class="token punctuation">,</span> Z<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>view_init<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">30</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token comment" spellcheck="true"># 初始位置不同 对应结果不同</span>
x <span class="token operator">=</span> tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> step <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">with</span> tf<span class="token punctuation">.</span>GradientTape<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tape<span class="token punctuation">:</span>
        tape<span class="token punctuation">.</span>watch<span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span>
        y <span class="token operator">=</span> himmelblau<span class="token punctuation">(</span>x<span class="token punctuation">)</span>

    grads <span class="token operator">=</span> tape<span class="token punctuation">.</span>gradient<span class="token punctuation">(</span>y<span class="token punctuation">,</span> <span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> 
    x <span class="token operator">-=</span> <span class="token number">0.01</span><span class="token operator">*</span>grads



    <span class="token keyword">if</span> step <span class="token operator">%</span> <span class="token number">20</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'step {}: x = {}, f(x) = {}'</span>
               <span class="token punctuation">.</span>format<span class="token punctuation">(</span>step<span class="token punctuation">,</span> x<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="fashion-mnist实战"><a href="#fashion-mnist实战" class="headerlink" title="fashion mnist实战"></a>fashion mnist实战</h2><h2 id="23-tensorboard-数据可视化"><a href="#23-tensorboard-数据可视化" class="headerlink" title="23.tensorboard 数据可视化"></a>23.tensorboard 数据可视化</h2><p>使用 pytorch visdom </p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#喂数据</span>
current_time <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y%m%d-%H%M%S"</span><span class="token punctuation">)</span>
log_dir <span class="token operator">=</span> <span class="token string">'logs/'</span> <span class="token operator">+</span> current_time
summary_writer <span class="token operator">=</span> tf<span class="token punctuation">.</span>summary<span class="token punctuation">.</span>create_file_writer<span class="token punctuation">(</span>log_dir<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#进入到logs目录</span>
tenosrboard <span class="token operator">-</span><span class="token operator">-</span>logdir logs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="24-keras高级API"><a href="#24-keras高级API" class="headerlink" title="24.keras高级API"></a>24.keras高级API</h2><p>主要功能 datasets / layers / losses / metrics / optimizers<br><strong>metrics</strong></p>
<pre class="line-numbers language-python"><code class="language-python">acc_meter <span class="token operator">=</span> metrics<span class="token punctuation">.</span>Accuracy<span class="token punctuation">(</span><span class="token punctuation">)</span>
loss_meter <span class="token operator">=</span> metrics<span class="token punctuation">.</span>Mean<span class="token punctuation">(</span><span class="token punctuation">)</span>

loss_meter<span class="token punctuation">.</span>update_state<span class="token punctuation">(</span>loss<span class="token punctuation">)</span>
acc_meter<span class="token punctuation">.</span>update_state<span class="token punctuation">(</span>y<span class="token punctuation">,</span> pred<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>step<span class="token punctuation">,</span> <span class="token string">'loss:'</span><span class="token punctuation">,</span> loss_meter<span class="token punctuation">.</span>result<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
loss_meter<span class="token punctuation">.</span>reset_states<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>compile / fit / evaluate / predict</p>
<pre class="line-numbers language-python"><code class="language-python">network<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>optimizer<span class="token operator">=</span>optimizers<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>lr<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        loss<span class="token operator">=</span>tf<span class="token punctuation">.</span>losses<span class="token punctuation">.</span>CategoricalCrossentropy<span class="token punctuation">(</span>from_logits<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        metrics<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'accuracy'</span><span class="token punctuation">]</span>
    <span class="token punctuation">)</span>

network<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>db<span class="token punctuation">,</span> epochs<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> validation_data<span class="token operator">=</span>ds_val<span class="token punctuation">,</span> validation_freq<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#2个epoch测试</span>
network<span class="token punctuation">.</span>evaluate<span class="token punctuation">(</span>ds_val<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#训练过程中验证</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="25-自定义网络层"><a href="#25-自定义网络层" class="headerlink" title="25.自定义网络层"></a>25.自定义网络层</h2><ul>
<li><p>keras.Swquential</p>
</li>
<li><p>keras.layers.Layer</p>
</li>
<li><p>keras.Model</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">MyDense</span><span class="token punctuation">(</span>layers<span class="token punctuation">.</span>Layer<span class="token punctuation">)</span><span class="token punctuation">:</span>

  <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> inp_dim<span class="token punctuation">,</span> outp_dim<span class="token punctuation">)</span><span class="token punctuation">:</span>
      super<span class="token punctuation">(</span>MyDense<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>

      self<span class="token punctuation">.</span>kernel <span class="token operator">=</span> self<span class="token punctuation">.</span>add_variable<span class="token punctuation">(</span><span class="token string">'w'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>inp_dim<span class="token punctuation">,</span> outp_dim<span class="token punctuation">]</span><span class="token punctuation">)</span>
      self<span class="token punctuation">.</span>bias <span class="token operator">=</span> self<span class="token punctuation">.</span>add_variable<span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>outp_dim<span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">def</span> <span class="token function">call</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> inputs<span class="token punctuation">,</span> training<span class="token operator">=</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span>

      out <span class="token operator">=</span> inputs @ self<span class="token punctuation">.</span>kernel <span class="token operator">+</span> self<span class="token punctuation">.</span>bias

      <span class="token keyword">return</span> out 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ul>
<p>class MyModel(keras.Model):</p>
<pre><code>def __init__(self):
    super(MyModel, self).__init__()

    self.fc1 = MyDense(28*28, 256)
    self.fc2 = MyDense(256, 128)
    self.fc3 = MyDense(128, 64)
    self.fc4 = MyDense(64, 32)
    self.fc5 = MyDense(32, 10)

def call(self, inputs, training=None):

    x = self.fc1(inputs)
    x = tf.nn.relu(x)
    x = self.fc2(x)
    x = tf.nn.relu(x)
    x = self.fc3(x)
    x = tf.nn.relu(x)
    x = self.fc4(x)
    x = tf.nn.relu(x)
    x = self.fc5(x) 

    return x</code></pre><pre><code>## 26.模型保存与加载
- save/load weights
```python
network.save_weights(&#39;weights.ckpt&#39;) #保存参数 
del network
#创建网络
network.load_weights(&#39;weights.ckpt&#39;)</code></pre><ul>
<li>save/load entire model<pre class="line-numbers language-python"><code class="language-python">network<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'model.h5'</span><span class="token punctuation">)</span>
<span class="token keyword">del</span> network
<span class="token comment" spellcheck="true">#不需要重新创建网络</span>
network<span class="token punctuation">.</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>models<span class="token punctuation">.</span>load_model<span class="token punctuation">(</span><span class="token string">'model.h5'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li>save_model #工业环境部署<pre class="line-numbers language-python"><code class="language-python">tf<span class="token punctuation">.</span>saved_model<span class="token punctuation">.</span>save<span class="token punctuation">(</span>m<span class="token punctuation">,</span><span class="token string">'/目录'</span><span class="token punctuation">)</span>
imported<span class="token operator">=</span>tf<span class="token punctuation">.</span>saved_model<span class="token punctuation">.</span>load<span class="token punctuation">(</span>path<span class="token punctuation">)</span>
f<span class="token operator">=</span>impored<span class="token punctuation">.</span>signatures<span class="token punctuation">[</span><span class="token string">"serving_default"</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">(</span>x<span class="token operator">=</span>tf<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ul>
<h2 id="27-过拟合与欠拟合"><a href="#27-过拟合与欠拟合" class="headerlink" title="27.过拟合与欠拟合"></a>27.过拟合与欠拟合</h2><p>under-fitting: Estimated &lt; Ground-truth<br>train acc is bad ,test acc is bad as well.</p>
<p>over-fitting: Ground-truth &lt; Estimated<br>train acc is much better ,test acc is worse .<br>==&gt; Generalization Performance 泛化能力变差</p>
<h2 id="28-数据集划分和交叉验证"><a href="#28-数据集划分和交叉验证" class="headerlink" title="28.数据集划分和交叉验证"></a>28.数据集划分和交叉验证</h2><p>train / val / test<br>如果test做验证 调参 会造成数据泄露 泛化能力降低</p>
<p>k-flod cross-validation<br>把train 划分为train和val训练 之后重新划分train和val训练</p>
<h2 id="29-减轻过拟合的方法"><a href="#29-减轻过拟合的方法" class="headerlink" title="29.减轻过拟合的方法"></a>29.减轻过拟合的方法</h2><ul>
<li>more data</li>
<li>constraint model complexity<br>降低模型复杂度 shallow / regularization</li>
<li>Dropout</li>
<li>Data argumentation</li>
<li>Early Stopping</li>
</ul>
<p><strong>Regularization</strong><br>loss function 中x的高次方参数 高维特征参数趋向0 </p>
<p>L1-Regularization 取网络所有权值的一范数 weight decay<br>L2-Regularization 取网络所有权值的二范数</p>
<p><strong>动量与学习率衰减</strong><br>momentum<br>当前的梯度方向加入动量 有利于找到最优解</p>
<p>learning rate decay<br>太小运算过慢 太大不收敛</p>
<h2 id="30-training-tricks"><a href="#30-training-tricks" class="headerlink" title="30.training tricks"></a>30.training tricks</h2><ul>
<li>Early Stopping<br>提前停止训练 防止过拟合<br>validation set to select parameters<br>monitor validation performance<br>stop at the highest val performance</li>
<li>Dropout<br>learning less to learn better 减少全连接层之间的链接</li>
<li>Stochastic Gradient Descent<br>取一个batch的梯度</li>
</ul>
<h2 id="31-卷积神经网络"><a href="#31-卷积神经网络" class="headerlink" title="31.卷积神经网络"></a>31.卷积神经网络</h2><p>Receptive Field # 类似人的眼睛 第一眼只看到感兴趣区域 通过扫描 滑动窗口获得全部信息</p>
<p>卷积核： 权值共享 滑动窗口 减少参数量</p>
<p>[b,5,5,c] =&gt; [c,3，3] kernel =&gt; [b,3,3,1] #图像c个通道 对应元素相乘累加<br>保持输入输出shape一致 padding &amp; stride(步长)</p>
<p>[b,5,5,c] =&gt; [n,c,3,3] n个kernel =&gt; [b,3,3,n] #多通道输入多通道输出</p>
<p>layers.kernal #[3,3,c,n]</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
<span class="token keyword">from</span> tensprflow<span class="token punctuation">.</span>keras <span class="token keyword">import</span> lyers

layer<span class="token operator">=</span>layers<span class="token punctuation">.</span>Conv2D<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span>kernel_size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>padding<span class="token operator">=</span><span class="token string">'same'</span><span class="token punctuation">)</span>

layers<span class="token punctuation">.</span>kernal <span class="token comment" spellcheck="true">#[5,5,c,n]</span>
layers<span class="token punctuation">.</span>bias <span class="token comment" spellcheck="true">#(4,)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="32-池化与采样"><a href="#32-池化与采样" class="headerlink" title="32.池化与采样"></a>32.池化与采样</h2><ul>
<li>pooling 降维过程<br>max/avg pooling 取最大/平均<br>sride <pre class="line-numbers language-python"><code class="language-python">x <span class="token comment" spellcheck="true">#[1,14,14,4]</span>
pool<span class="token operator">=</span>layers<span class="token punctuation">.</span>MaxPool2D<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>strides<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
out<span class="token operator">=</span>pool<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># tensorshape [1,7,7,4]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ul>
<p>out=tf.nn.max_pool2d(x,2,strides=2,padding=’VALID’)</p>
<pre><code>- unsample 升维
```python
x=tf.random.normal([1,7,7,4])
layer=layers.UnSampling2D(size=3)
out=layer(x)
# tensorshape [1,21,21,4]</code></pre><ul>
<li>ReLU 同relu函数</li>
</ul>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">huazhe</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://huazhe1995.github.io/2020/03/15/tensorflow-bi-ji/">http://huazhe1995.github.io/2020/03/15/tensorflow-bi-ji/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://huazhe1995.github.io" target="_blank">huazhe's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/tensorflow/">tensorflow</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/03/19/ros-bi-ji/"><img class="prev_cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">ROS笔记</div></div></a></div><div class="next-post pull_right"><a href="/2020/03/14/ros-diao-yong-cv-bridge-wen-ti/"><img class="next_cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">ROS调用cv_bridge问题</div></div></a></div></nav></article></main><footer id="footer" style="background-image: url(https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2020 By huazhe</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script id="ribbon_piao" mobile="false" src="/js/third-party/piao.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@3/instantpage.min.js" type="module"></script></body></html>